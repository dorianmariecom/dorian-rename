#!/usr/bin/env ruby
# frozen_string_literal: true

if ARGV.size < 3 || ARGV[0] == "--help" || ARGV[0] == "-h"
  puts "USAGE: replace FROM TO FILES..."
  puts "USAGE: ... | replace FROM TO"
  exit
end

def rename(old, new)
  if old != new
    puts "#{old} -> #{new}"
    File.rename(old, new)
  end
end

from = ARGV[0]
to = ARGV[1]
files = ARGV[2..]
directories = files.select { |file| File.directory?(file) }
(files - directories).each { |file| rename(file, file.gsub(from, to)) }
directories.each { |directory| rename(directory, directory.gsub(from, to)) }
